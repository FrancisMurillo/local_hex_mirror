# Local Hex Mirror

A sample Elixir development environment using a Phoenix umbrella app to
show local dependencies within docker from this [article](https://fnlog.dev/wanderer/elixir-bit-offline-docker-hex-mirror/).

Created from `mix phx.new --no-html --no-assets --umbrella local_hex`,
this docker-compose application that can be started with `docker-compose
up` should work and demonstrate `mix deps.get` can fetch offline
dependencies. The important points about this repository are:

* `.hex_repo`

    The custom repository generated by `mix hex.registry build`. It
    should be served with a static file server to be a `hexpm` server.

    This should be added to `git` to make the depedencies consistent.

* `rebuild_local_repo.sh`

    A one-line script to rebuild `.hex_repo` when new dependencies are
    added.

* `update_local_repo.ex`

    A simple Elixir script to fetch every dependencies (except git) of the
    application by reading the `mix.lock` file and downloading them with
    `mix hex.package fetch` to `.hex_repo/tarballs`

    Execute `update_local_repo.ex` every time a new dependency is added
    then run `rebuild_local_repo.sh` or in short:

    ```shell
    elixir update_local_repo.ex
    sh rebuild_local_repo.sh
    ```
* `docker-compose.yml`

    The docker-compose file to run the Elixir container as well as its
    dependencies. In particular, `app_deps` is the `nginx` static file
    server to host `.hex_repo`.

* `docker-entrypoint.sh`

    The docker startup script to override the default `hexpm` via `mix
    hex.repo add` with our local version via the `HEX_REGISTRY` docker
    environment variable.
